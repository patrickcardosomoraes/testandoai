name: Post Diário Automático

on:
  schedule:
    # Horários: 8h, 14h e 20h (UTC = 5h, 11h, 17h no Brasil)
    - cron: '0 8 * * *'
    - cron: '0 14 * * *'
    - cron: '0 20 * * *'
  workflow_dispatch:

jobs:
  gerar-post:
    runs-on: ubuntu-latest

    steps:
      - name: 🔄 Clonar o repositório
        uses: actions/checkout@v3

      - name: 🐍 Instalar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 📦 Instalar dependências
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 📄 Criar variáveis de ambiente
        run: echo "OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }}" >> .env

      - name: 🤖 Rodar o script de geração
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: python scripts/gerar_post.py

      - name: 📤 Commit e Push dos novos posts
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add posts/ public/results/ logs/
          git commit -m "📝 Post automático gerado por IA" || echo "Nenhuma mudança"
          git push